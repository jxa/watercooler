<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <script src="/javascript/jquery.js" type="text/javascript"></script>
    <link href="screen.css" type="text/css" rel="stylesheet">
    <title>Watercooler Chat - %room%</title>
    <script>
  var newest_message=0;
  function new_messages(){
    url = "/api/messages/%room%"
    if(newest_message!=0){ url = url+"?newer_than="+newest_message; };
    $.getJSON(url,
        function(data){
          $.each(data, function(i,item){
            $("<dt/>").text(item.author).appendTo("#messages");
            $("<dd/>").text(item.body).appendTo("#messages");
            newest_message = item.id;
          });
        });
  }
  $(document).ready(function(){message_refresh();});
  function message_refresh(){
    new_messages();
    setTimeout("message_refresh()",5000);
  }
  </script>
  </head>
  <body>
    <h1>%room%: %topic%</h1>
    <div id="content">
      <dl id="messages"></dl>
    </div>
  </body>
</html>
